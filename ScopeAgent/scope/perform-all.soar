# elaborate to consolidate existing all tasks into one wme that indicates that any exist
sp {elaborate*tasks-exist
   (state <s> ^name scope
              # test for new so that support will
              # retract when perform-all is applied,
              # so we don't get an operator-no-change impasse
              ^io.input-link.task.new)
-->
   (<s> ^tasks-exist yes)
}

# propose perform-all as long as there are any tasks
sp {propose*perform-all
   (state <s> ^name scope
              ^tasks-exist yes
              ^strategy-counter)
-->
   (<s> ^operator <o> +)
   (<o> ^name perform-all)
}

# TODO this will propose one perform-all operator for _every_ task that exists
# 1)we could solve this by making all perform-all operators are indifferent to each other
# however, it would be better not to propose a bunch of them, and just propose one instead
# 2)this may be achieved by simply testing for (<input> ^task) above, instead of (<input> ^task <task>)
# No. that does not work
# 3)ooh, another option: elaborate based on the existence of a task to a single WME
# then propose perform-all based on that
# 3) seems to work well so we shouldn't need to indifferent them, i am removing it for now
#sp {equate*all*perform-all
#   (state <s> ^name scope
#              ^operator <o1> +
#              ^operator { <o2> <> <o1> } +)
#   (<o1> ^name perform-all)
#   (<o2> ^name perform-all)
#-->
#   (<s> ^operator <o1> = <o2>)
#}

sp {apply*perform-all
   (state <s> ^name scope
              ^operator <o>
              ^io.output-link <output>)
   (<o> ^name perform-all)
-->
   (<output> ^strategy <st>)
   (<st> ^name perform-all)
   (write (crlf) |Perform All|)
}